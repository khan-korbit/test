# .github/workflows/gitleaks_baseline.yml
name: Gitleaks Scan with Baseline & Slack Notify

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  gitleaks:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # ì „ì²´ Git íˆìŠ¤í† ë¦¬ë¥¼ ê°€ì ¸ì™€ ìŠ¤ìº”

      - name: Run Gitleaks
        id: gitleaks
        uses: gitleaks/gitleaks-action@v2
        # Gitleaksê°€ ìœ ì¶œì„ íƒì§€í•˜ë©´ non-zero exit codeë¥¼ ë°˜í™˜í•˜ì—¬ ì´ ìŠ¤í…ì€ ì‹¤íŒ¨í•©ë‹ˆë‹¤.
        # ì‹¤íŒ¨ ì‹œ ì´í›„ ìŠ¤í…(Slack ì•Œë¦¼)ì´ ì¡°ê±´ë¶€ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.

      - name: Gitleaks scan passed
        if: success()
        run: echo "âœ… Gitleaks scan passed. No leaks found."

      - name: Send Slack notification on failure
        if: failure()
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK_URL }}
          SLACK_TITLE: "ğŸš¨ Gitleaks Alert: Secrets Detected!"
          SLACK_MESSAGE: "A Gitleaks scan detected potential secrets in a recent commit. Please review the findings and take immediate action."
          SLACK_COLOR: 'danger' # ë˜ëŠ” 16ì§„ìˆ˜ ìƒ‰ìƒ ì½”ë“œ
          SLACK_USERNAME: "Gitleaks Bot"
          SLACK_ICON_EMOJI: ":gitleaks:"
          MSG_MINIMAL: true
